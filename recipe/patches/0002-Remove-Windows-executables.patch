From d4308a688c7b89477d27a80234c80a9bdff7aa52 Mon Sep 17 00:00:00 2001
From: Michael McAuliffe <michael.e.mcauliffe@gmail.com>
Date: Thu, 13 Oct 2022 23:04:24 -0700
Subject: [PATCH] Update CMake to skip installation of executables on Windows

---
 cmake/third_party/openfst.cmake | 59 ++++-----------------------------
 1 file changed, 6 insertions(+), 53 deletions(-)

diff --git a/cmake/third_party/openfst.cmake b/cmake/third_party/openfst.cmake
index f9fff8a..e004bf2 100644
--- a/cmake/third_party/openfst.cmake
+++ b/cmake/third_party/openfst.cmake
@@ -17,61 +17,14 @@ if(NOT openfst_POPULATED)
 
     if(CONDA_ROOT)
 
-        if(MSVC)
-            install(TARGETS fstarcsort fstclosure fstcompile fstcompose fstconcat fstconnect fstconvert fstdeterminize
-                            fstdifference fstdisambiguate fstdraw fstencode fstepsnormalize fstequal fstequivalent
-                            fstinfo fstintersect fstinvert fstisomorphic fstmap fstminimize fstprint fstproject fstprune
-                            fstpush fstrandgen fstrelabel fstreplace fstreverse fstreweight fstrmepsilon fstshortestdistance
-                            fstshortestpath fstsymbols fstsynchronize fsttopsort fstunion
-            RUNTIME
-                DESTINATION ${CMAKE_INSTALL_BINDIR}
-                COMPONENT kaldi
-            )
-            install(TARGETS farcompilestrings farcreate farequal farextract farinfo farisomorphic farprintstrings
-            RUNTIME
-                DESTINATION ${CMAKE_INSTALL_BINDIR}
-                COMPONENT kaldi
-            )
-            install(TARGETS fstlinear fstloglinearapply
-            RUNTIME
-                DESTINATION ${CMAKE_INSTALL_BINDIR}
-                COMPONENT kaldi
-            )
-            install(TARGETS mpdtcompose mpdtexpand mpdtinfo mpdtreverse
-            RUNTIME
-                DESTINATION ${CMAKE_INSTALL_BINDIR}
-                COMPONENT kaldi
-            )
-            install(TARGETS pdtcompose pdtexpand pdtinfo pdtreplace pdtreverse pdtshortestpath
-            RUNTIME
-                DESTINATION ${CMAKE_INSTALL_BINDIR}
-                COMPONENT kaldi
-            )
-            install(TARGETS fstspecial
-            RUNTIME
-                DESTINATION ${CMAKE_INSTALL_BINDIR}
-                COMPONENT kaldi
-            )
-
-            install(DIRECTORY ${openfst_SOURCE_DIR}/src/include/ DESTINATION include/
+        
+        install(TARGETS fst
+                LIBRARY
+                    DESTINATION ${CMAKE_INSTALL_LIBDIR}
                     COMPONENT kaldi
-                    FILES_MATCHING PATTERN "*.h")
-
-            install(TARGETS fst
-                    EXPORT kaldi-targets
-                    ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR} COMPONENT kaldi
-                    LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR} COMPONENT kaldi NAMELINK_SKIP
-                    RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR} COMPONENT kaldi)
-        else()
-
-            install(TARGETS fst
-                    LIBRARY
-                        DESTINATION ${CMAKE_INSTALL_LIBDIR}
-                        COMPONENT kaldi
-                        NAMELINK_SKIP # Link to so with version to avoid conflicts with OpenFst 1.8.1 on conda
-                    )
+                    NAMELINK_SKIP # Link to so with version to avoid conflicts with OpenFst 1.8.1 on conda
+                )
 
-        endif()
 
     else() # Original functionality
 
-- 
2.38.0

