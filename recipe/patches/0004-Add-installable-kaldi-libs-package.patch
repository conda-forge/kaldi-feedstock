From 3ef139cd41e80666225d6c401eb7b3642250da45 Mon Sep 17 00:00:00 2001
From: Michael McAuliffe <michael.e.mcauliffe@gmail.com>
Date: Thu, 13 Oct 2022 18:05:58 -0700
Subject: [PATCH] Add installable kaldi libs package

---
 egs/wsj/s5/steps/libs/nnet3/report/log_parse.py      |  2 +-
 .../libs/nnet3/train/chain_objf/acoustic_model.py    |  4 ++--
 egs/wsj/s5/steps/libs/nnet3/train/common.py          |  4 ++--
 .../nnet3/train/frame_level_objf/acoustic_model.py   |  4 ++--
 .../libs/nnet3/train/frame_level_objf/common.py      |  4 ++--
 .../libs/nnet3/train/frame_level_objf/raw_model.py   |  2 +-
 egs/wsj/s5/steps/libs/nnet3/xconfig/attention.py     |  2 +-
 egs/wsj/s5/steps/libs/nnet3/xconfig/basic_layers.py  |  4 ++--
 .../s5/steps/libs/nnet3/xconfig/composite_layers.py  |  2 +-
 egs/wsj/s5/steps/libs/nnet3/xconfig/convolution.py   |  2 +-
 egs/wsj/s5/steps/libs/nnet3/xconfig/gru.py           |  2 +-
 egs/wsj/s5/steps/libs/nnet3/xconfig/lstm.py          |  2 +-
 egs/wsj/s5/steps/libs/nnet3/xconfig/parser.py        |  6 +++---
 egs/wsj/s5/steps/libs/nnet3/xconfig/stats_layer.py   |  2 +-
 .../s5/steps/libs/nnet3/xconfig/trivial_layers.py    |  2 +-
 python_package/kaldi_libs                            |  1 +
 python_package/setup.cfg                             | 12 ++++++++++++
 python_package/setup.py                              |  3 +++
 18 files changed, 38 insertions(+), 22 deletions(-)
 create mode 120000 python_package/kaldi_libs
 create mode 100644 python_package/setup.cfg
 create mode 100644 python_package/setup.py

diff --git a/egs/wsj/s5/steps/libs/nnet3/report/log_parse.py b/egs/wsj/s5/steps/libs/nnet3/report/log_parse.py
index 97da5e0..5658b4f 100755
--- a/egs/wsj/s5/steps/libs/nnet3/report/log_parse.py
+++ b/egs/wsj/s5/steps/libs/nnet3/report/log_parse.py
@@ -11,7 +11,7 @@ import datetime
 import logging
 import re
 
-import libs.common as common_lib
+import kaldi_libs.common as common_lib
 
 logger = logging.getLogger(__name__)
 logger.addHandler(logging.NullHandler())
diff --git a/egs/wsj/s5/steps/libs/nnet3/train/chain_objf/acoustic_model.py b/egs/wsj/s5/steps/libs/nnet3/train/chain_objf/acoustic_model.py
index 1580722..55e6286 100644
--- a/egs/wsj/s5/steps/libs/nnet3/train/chain_objf/acoustic_model.py
+++ b/egs/wsj/s5/steps/libs/nnet3/train/chain_objf/acoustic_model.py
@@ -15,8 +15,8 @@ import math
 import os
 import sys
 
-import libs.common as common_lib
-import libs.nnet3.train.common as common_train_lib
+import kaldi_libs.common as common_lib
+import kaldi_libs.nnet3.train.common as common_train_lib
 
 logger = logging.getLogger(__name__)
 logger.addHandler(logging.NullHandler())
diff --git a/egs/wsj/s5/steps/libs/nnet3/train/common.py b/egs/wsj/s5/steps/libs/nnet3/train/common.py
index eac376f..c7fe427 100644
--- a/egs/wsj/s5/steps/libs/nnet3/train/common.py
+++ b/egs/wsj/s5/steps/libs/nnet3/train/common.py
@@ -17,8 +17,8 @@ import math
 import re
 import shutil
 
-import libs.common as common_lib
-from libs.nnet3.train.dropout_schedule import *
+import kaldi_libs.common as common_lib
+from kaldi_libs.nnet3.train.dropout_schedule import *
 
 logger = logging.getLogger(__name__)
 logger.addHandler(logging.NullHandler())
diff --git a/egs/wsj/s5/steps/libs/nnet3/train/frame_level_objf/acoustic_model.py b/egs/wsj/s5/steps/libs/nnet3/train/frame_level_objf/acoustic_model.py
index 4a39ed9..c529aad 100644
--- a/egs/wsj/s5/steps/libs/nnet3/train/frame_level_objf/acoustic_model.py
+++ b/egs/wsj/s5/steps/libs/nnet3/train/frame_level_objf/acoustic_model.py
@@ -10,8 +10,8 @@ training of deep neural network acoustic model with frame-level objective.
 
 import logging
 
-import libs.common as common_lib
-import libs.nnet3.train.common as common_train_lib
+import kaldi_libs.common as common_lib
+import kaldi_libs.nnet3.train.common as common_train_lib
 
 
 logger = logging.getLogger(__name__)
diff --git a/egs/wsj/s5/steps/libs/nnet3/train/frame_level_objf/common.py b/egs/wsj/s5/steps/libs/nnet3/train/frame_level_objf/common.py
index f272235..045eecd 100644
--- a/egs/wsj/s5/steps/libs/nnet3/train/frame_level_objf/common.py
+++ b/egs/wsj/s5/steps/libs/nnet3/train/frame_level_objf/common.py
@@ -18,8 +18,8 @@ import os
 import random
 import time
 
-import libs.common as common_lib
-import libs.nnet3.train.common as common_train_lib
+import kaldi_libs.common as common_lib
+import kaldi_libs.nnet3.train.common as common_train_lib
 
 logger = logging.getLogger(__name__)
 logger.addHandler(logging.NullHandler())
diff --git a/egs/wsj/s5/steps/libs/nnet3/train/frame_level_objf/raw_model.py b/egs/wsj/s5/steps/libs/nnet3/train/frame_level_objf/raw_model.py
index 7f21af0..cf9745a 100644
--- a/egs/wsj/s5/steps/libs/nnet3/train/frame_level_objf/raw_model.py
+++ b/egs/wsj/s5/steps/libs/nnet3/train/frame_level_objf/raw_model.py
@@ -11,7 +11,7 @@ with frame-level objective.
 
 import logging
 
-import libs.common as common_lib
+import kaldi_libs.common as common_lib
 
 logger = logging.getLogger(__name__)
 logger.addHandler(logging.NullHandler())
diff --git a/egs/wsj/s5/steps/libs/nnet3/xconfig/attention.py b/egs/wsj/s5/steps/libs/nnet3/xconfig/attention.py
index db4cb39..fb79c17 100644
--- a/egs/wsj/s5/steps/libs/nnet3/xconfig/attention.py
+++ b/egs/wsj/s5/steps/libs/nnet3/xconfig/attention.py
@@ -10,7 +10,7 @@ from __future__ import division
 import math
 import re
 import sys
-from libs.nnet3.xconfig.basic_layers import XconfigLayerBase
+from kaldi_libs.nnet3.xconfig.basic_layers import XconfigLayerBase
 
 # This class is for parsing lines like
 #  'attention-renorm-layer num-heads=10 value-dim=50 key-dim=50 time-stride=3 num-left-inputs=5 num-right-inputs=2.'
diff --git a/egs/wsj/s5/steps/libs/nnet3/xconfig/basic_layers.py b/egs/wsj/s5/steps/libs/nnet3/xconfig/basic_layers.py
index e18c135..db00764 100644
--- a/egs/wsj/s5/steps/libs/nnet3/xconfig/basic_layers.py
+++ b/egs/wsj/s5/steps/libs/nnet3/xconfig/basic_layers.py
@@ -13,8 +13,8 @@ from __future__ import division
 import math
 import re
 import sys
-import libs.nnet3.xconfig.utils as xutils
-import libs.common as common_lib
+import kaldi_libs.nnet3.xconfig.utils as xutils
+import kaldi_libs.common as common_lib
 
 
 class XconfigLayerBase(object):
diff --git a/egs/wsj/s5/steps/libs/nnet3/xconfig/composite_layers.py b/egs/wsj/s5/steps/libs/nnet3/xconfig/composite_layers.py
index 928ca44..0740e5c 100644
--- a/egs/wsj/s5/steps/libs/nnet3/xconfig/composite_layers.py
+++ b/egs/wsj/s5/steps/libs/nnet3/xconfig/composite_layers.py
@@ -8,7 +8,7 @@ from __future__ import print_function
 import math
 import re
 import sys
-from libs.nnet3.xconfig.basic_layers import XconfigLayerBase
+from kaldi_libs.nnet3.xconfig.basic_layers import XconfigLayerBase
 
 # This class is intended to implement an extension of the factorized TDNN
 # (TDNN-F) that supports resnet-type 'bypass' connections.  It is for lines like
diff --git a/egs/wsj/s5/steps/libs/nnet3/xconfig/convolution.py b/egs/wsj/s5/steps/libs/nnet3/xconfig/convolution.py
index 1628a5e..a928b58 100644
--- a/egs/wsj/s5/steps/libs/nnet3/xconfig/convolution.py
+++ b/egs/wsj/s5/steps/libs/nnet3/xconfig/convolution.py
@@ -11,7 +11,7 @@ from __future__ import division
 import math
 import re
 import sys
-from libs.nnet3.xconfig.basic_layers import XconfigLayerBase
+from kaldi_libs.nnet3.xconfig.basic_layers import XconfigLayerBase
 
 
 # This class is for lines like the following:
diff --git a/egs/wsj/s5/steps/libs/nnet3/xconfig/gru.py b/egs/wsj/s5/steps/libs/nnet3/xconfig/gru.py
index 2f387a6..afba6e9 100644
--- a/egs/wsj/s5/steps/libs/nnet3/xconfig/gru.py
+++ b/egs/wsj/s5/steps/libs/nnet3/xconfig/gru.py
@@ -11,7 +11,7 @@ from __future__ import print_function
 import math
 import re
 import sys
-from libs.nnet3.xconfig.basic_layers import XconfigLayerBase
+from kaldi_libs.nnet3.xconfig.basic_layers import XconfigLayerBase
 
 # This class is for lines like
 #   'gru-layer name=gru1 input=[-1] delay=-3'
diff --git a/egs/wsj/s5/steps/libs/nnet3/xconfig/lstm.py b/egs/wsj/s5/steps/libs/nnet3/xconfig/lstm.py
index 4910a4a..069e9e7 100644
--- a/egs/wsj/s5/steps/libs/nnet3/xconfig/lstm.py
+++ b/egs/wsj/s5/steps/libs/nnet3/xconfig/lstm.py
@@ -10,7 +10,7 @@ from __future__ import print_function
 import math
 import re
 import sys
-from libs.nnet3.xconfig.basic_layers import XconfigLayerBase
+from kaldi_libs.nnet3.xconfig.basic_layers import XconfigLayerBase
 
 
 # This class is for lines like
diff --git a/egs/wsj/s5/steps/libs/nnet3/xconfig/parser.py b/egs/wsj/s5/steps/libs/nnet3/xconfig/parser.py
index 5e21c4c..1e14b14 100644
--- a/egs/wsj/s5/steps/libs/nnet3/xconfig/parser.py
+++ b/egs/wsj/s5/steps/libs/nnet3/xconfig/parser.py
@@ -9,10 +9,10 @@ from __future__ import print_function
 
 import logging
 import sys
-import libs.nnet3.xconfig.layers as xlayers
-import libs.nnet3.xconfig.utils as xutils
+import kaldi_libs.nnet3.xconfig.layers as xlayers
+import kaldi_libs.nnet3.xconfig.utils as xutils
 
-import libs.common as common_lib
+import kaldi_libs.common as common_lib
 
 
 # We have to modify this dictionary when adding new layers
diff --git a/egs/wsj/s5/steps/libs/nnet3/xconfig/stats_layer.py b/egs/wsj/s5/steps/libs/nnet3/xconfig/stats_layer.py
index 77e7bbb..d7e2a9f 100644
--- a/egs/wsj/s5/steps/libs/nnet3/xconfig/stats_layer.py
+++ b/egs/wsj/s5/steps/libs/nnet3/xconfig/stats_layer.py
@@ -7,7 +7,7 @@
 
 from __future__ import print_function
 import re
-from libs.nnet3.xconfig.basic_layers import XconfigLayerBase
+from kaldi_libs.nnet3.xconfig.basic_layers import XconfigLayerBase
 
 
 class XconfigStatsLayer(XconfigLayerBase):
diff --git a/egs/wsj/s5/steps/libs/nnet3/xconfig/trivial_layers.py b/egs/wsj/s5/steps/libs/nnet3/xconfig/trivial_layers.py
index 4afea78..b306208 100644
--- a/egs/wsj/s5/steps/libs/nnet3/xconfig/trivial_layers.py
+++ b/egs/wsj/s5/steps/libs/nnet3/xconfig/trivial_layers.py
@@ -11,7 +11,7 @@ from __future__ import print_function
 import math
 import re
 import sys
-from libs.nnet3.xconfig.basic_layers import XconfigLayerBase
+from kaldi_libs.nnet3.xconfig.basic_layers import XconfigLayerBase
 
 
 class XconfigRenormComponent(XconfigLayerBase):
diff --git a/python_package/kaldi_libs b/python_package/kaldi_libs
new file mode 120000
index 0000000..31c5f54
--- /dev/null
+++ b/python_package/kaldi_libs
@@ -0,0 +1 @@
+../egs/wsj/s5/steps/libs
\ No newline at end of file
diff --git a/python_package/setup.cfg b/python_package/setup.cfg
new file mode 100644
index 0000000..ac1321d
--- /dev/null
+++ b/python_package/setup.cfg
@@ -0,0 +1,12 @@
+[metadata]
+name = Kaldi libs
+description = Library for Kaldi python functions
+url = https://github.com/kaldi-asr/kaldi/tree/master/egs/wsj/s5/steps/libs
+author = Kaldi
+license = Apache-2.0
+license_file = COPYING
+version = 5.5.1056
+
+[options]
+packages = find:
+python_requires = >=3.8
\ No newline at end of file
diff --git a/python_package/setup.py b/python_package/setup.py
new file mode 100644
index 0000000..6068493
--- /dev/null
+++ b/python_package/setup.py
@@ -0,0 +1,3 @@
+from setuptools import setup
+
+setup()
-- 
2.37.1

